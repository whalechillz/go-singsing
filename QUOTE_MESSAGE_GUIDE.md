# 견적서 메시지 발송 기능 가이드

## 개요
견적서 페이지에서 고객에게 직접 SMS나 카카오톡으로 견적서 링크를 발송할 수 있는 기능입니다.

## 주요 기능
- **SMS 발송**: 견적서 링크를 문자메시지로 발송
- **카카오 알림톡**: 카카오톡 알림톡으로 견적서 발송 (템플릿 승인 필요)
- **메시지 미리보기**: 발송 전 메시지 내용 확인
- **수신자 정보 자동 입력**: 견적서에 저장된 고객 정보 자동 연동

## 사용 방법

### 1. 마이그레이션 실행
먼저 견적서용 메시지 템플릿을 데이터베이스에 추가해야 합니다:

```bash
# 실행 권한 부여
./make-executable.sh

# 마이그레이션 실행
./apply-quote-message-migration.sh
```

### 2. 견적서에서 메시지 발송
1. 견적서 편집 페이지로 이동
2. 상단의 "메시지 발송" 버튼 클릭
3. 수신자 정보 확인/수정
4. 발송 방법 선택 (SMS 또는 카카오톡)
5. 메시지 미리보기 확인
6. "발송하기" 버튼 클릭

## 메시지 템플릿

### SMS 템플릿
```
#{이름}님, 요청하신 견적서입니다.

#{견적서명}

▶ #{url}

유효기간: #{만료일}
문의: 031-215-3990
```

### 카카오 알림톡 템플릿
```
#{이름}님, 안녕하세요.
싱싱골프입니다.

요청하신 #{견적서명} 안내드립니다.

▶ 견적 상세보기
#{url}

■ 유효기간: #{만료일}
■ 문의전화: 031-215-3990

견적서는 유효기간 내에만 확인 가능합니다.
감사합니다.
```

## 변수 설명
- `#{이름}`: 고객명 (견적서의 customer_name)
- `#{견적서명}`: 견적서 제목
- `#{url}`: 견적서 공개 링크 (자동 생성)
- `#{만료일}`: 견적 유효기간

## 카카오 알림톡 설정
카카오 알림톡을 사용하려면:

1. 카카오 비즈니스 채널에서 템플릿 등록
2. 템플릿 승인 후 템플릿 코드 확인
3. 데이터베이스 업데이트:
```sql
UPDATE message_templates 
SET kakao_template_code = '승인받은_템플릿_코드'
WHERE name = '견적서 알림톡' AND use_case = 'quote';
```

## 주의사항
- 카카오 알림톡은 사전 승인된 템플릿만 사용 가능
- SMS는 건당 요금이 발생함
- 공개 링크가 없는 견적서는 내부 링크로 발송됨
- 유효기간이 지난 견적서도 발송은 가능하나, 고객이 접근 시 만료 안내가 표시됨

## 문제 해결
- **"템플릿을 찾을 수 없습니다"**: 마이그레이션 실행 확인
- **카카오톡 발송 실패**: 템플릿 승인 여부 및 코드 확인
- **SMS 발송 실패**: 솔라피 API 키 및 잔액 확인
