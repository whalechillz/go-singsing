# 결제 관리 시스템 통합 가이드

## 시스템 개요
싱싱골프투어 결제 관리 시스템은 투어 참가자의 결제를 효율적으로 관리하는 통합 솔루션입니다.

## 현재 버전: V3 (2025-01-27)

### 주요 기능
1. **계약금/잔금 관리**
   - 계약금: 투어 가격의 30% (기본값, 조정 가능)
   - 잔금: 투어 가격의 70% (기본값, 조정 가능)
   - 전액: 100%
   - 사용자 정의 금액 설정 가능

2. **결제 상태 관리**
   - 완료 (completed): 결제 완료
   - 대기 (pending): 결제 대기중
   - 취소 (cancelled): 결제 취소
   - 환불 (refunded): 환불 완료

3. **그룹 결제**
   - 대표 결제자가 그룹 전체 결제
   - 동반자 정보 자동 연동
   - 그룹 멤버 자동 선택

4. **대시보드**
   - 총 수입 (환불 제외)
   - 계약금/잔금 현황
   - 참가자별 결제 상태
   - 미수금 관리

5. **환불 처리**
   - 환불 사유 필수 입력
   - 환불 내역 추적
   - 되돌리기 불가 (신중한 처리 필요)

## 데이터베이스 구조

### singsing_payments 테이블
```sql
- id: UUID (Primary Key)
- tour_id: UUID (투어 ID)
- participant_id: UUID (참가자 ID)
- payer_id: UUID (대표 결제자 ID)
- payment_method: VARCHAR (bank/card/cash)
- amount: INTEGER (결제 금액)
- payment_type: VARCHAR (deposit/balance/full)
- payment_status: VARCHAR (completed/pending/cancelled/refunded)
- payment_date: TIMESTAMP (결제일)
- is_group_payment: BOOLEAN (그룹 결제 여부)
- receipt_type: VARCHAR (영수증 종류)
- receipt_requested: BOOLEAN (영수증 요청)
- note: TEXT (메모)
- created_at: TIMESTAMP
```

## 사용 가이드

### 1. 계약금 받기
```
1. "결제 추가" 클릭
2. 참가자 선택
3. 결제 구분: "계약금" 선택
4. 금액 설정 (자동 계산 또는 직접 입력)
5. 저장
```

### 2. 그룹 결제 처리
```
1. "결제 추가" 클릭
2. 대표 결제자 선택
3. "일괄 결제" 체크
4. 그룹 멤버 자동 선택 확인
5. 총 금액 확인 후 저장
```

### 3. 환불 처리
```
1. 결제 목록에서 환불 버튼(🔄) 클릭
2. 환불 사유 입력
3. "환불 처리" 클릭
```

## 최근 개선사항 (2025-05-28)

### UI/UX 개선
- 결제 현황 대시보드 통합
- 3단 구조로 재구성 (가독성 향상)
- 투어 날짜 정보 추가
- 수금 진행률 표시

### 기능 개선
- 유연한 금액 설정 (V3)
  - 빠른 금액 버튼 (10만원 단위)
  - 비율 계산기
  - 직접 입력
- 그룹 정보 실시간 연동
- 동반자 이름 기반 자동 매칭

## 운영 팁

### 효율적인 결제 관리
1. **참가자 등록 시**: 정확한 그룹 정보 입력
2. **계약금 수령**: 일괄적으로 30% 또는 정액 처리
3. **잔금 관리**: 출발 전 미수금 확인
4. **환불 처리**: 사유 명확히 기록

### 주의사항
- 환불은 되돌릴 수 없음
- 그룹 결제 수정 시 멤버 재확인 필요
- 금액 변경은 새 결제로 처리 권장

## 향후 개발 계획

### 단기 (1-2개월)
- 엑셀 다운로드 기능
- 결제 내역 인쇄 기능
- 영수증 자동 생성

### 중기 (3-6개월)
- 알림톡 연동
- 온라인 결제 연동
- 자동 미수금 알림

### 장기 (6개월+)
- 통계 분석 기능
- 회계 시스템 연동
- 모바일 앱 지원

---
*최종 업데이트: 2025-05-30*
