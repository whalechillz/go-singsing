# 결제 관리 시스템 업그레이드 가이드

## 개요
결제 관리 시스템을 계약금/잔금 관리와 환불 처리가 가능한 프로페셔널한 버전으로 업그레이드합니다.

## 주요 변경사항

### 1. 데이터베이스 컬럼 활용
기존에 있던 컬럼들을 실제로 활용:
- `payment_type`: deposit(계약금), balance(잔금), full(전액)
- `payment_status`: completed(완료), pending(대기), cancelled(취소), refunded(환불)
- `payment_date`: 결제일

### 2. 새로운 기능
- **계약금/잔금 관리**: 투어 가격의 30%/70% 자동 계산
- **환불 처리**: 완료된 결제의 환불 기능
- **대시보드**: 총 수입, 계약금, 미수금, 환불 현황
- **참가자별 결제 현황**: 완납/미납/부분납부 상태

### 3. UI/UX 개선
- 프로페셔널한 디자인 (그림자, 아이콘, 색상)
- 직관적인 탭 구조
- 실시간 금액 계산
- 모바일 반응형

## 배포 체크리스트

### 1. 백업
```bash
# 기존 파일 백업
cp components/payments/PaymentManager.tsx backup_files/payments/PaymentManager_backup_20250127.tsx
```

### 2. 테스트
- [ ] 개발 환경에서 테스트
- [ ] 계약금/잔금 계산 확인
- [ ] 그룹 결제 동작 확인
- [ ] 환불 처리 확인

### 3. 배포
```bash
# 빌드 및 배포
npm run build
git add -A
git commit -m "feat: 결제 관리 시스템 대규모 개선
- 계약금(30%)/잔금(70%) 자동 계산 기능 추가
- 결제 상태 관리 (완료/대기/취소/환불)
- 환불 처리 기능 추가
- 프로페셔널한 대시보드 UI
- 참가자별 결제 현황 한눈에 확인
- 영수증 종류 선택 (세금계산서/현금영수증/간이영수증)"

git push origin main
```

## 사용 가이드

### 1. 계약금 받기
1. "결제 추가" 클릭
2. 결제 구분에서 "계약금 (30%)" 선택
3. 금액이 자동으로 계산됨
4. 저장

### 2. 잔금 받기
1. "결제 추가" 클릭
2. 결제 구분에서 "잔금 (70%)" 선택
3. 금액이 자동으로 계산됨
4. 저장

### 3. 환불 처리
1. 결제 목록에서 환불할 항목의 환불 버튼(🔄) 클릭
2. 환불 사유 입력
3. "환불 처리" 클릭

### 4. 결제 현황 확인
- 상단 대시보드: 총 수입, 계약금, 미수금, 환불 현황
- 하단 요약: 완납자, 부분납부자, 미납자 수

## 추가 개발 제안

### 1. 엑셀 다운로드 기능
```typescript
const downloadExcel = async () => {
  // 결제 내역을 엑셀로 다운로드
  // SheetJS 라이브러리 활용
};
```

### 2. 알림톡 연동
- 계약금 입금 안내
- 잔금 납부 안내
- 환불 완료 알림

### 3. 결제 리마인더
- 미납자 자동 알림
- 잔금 납부 기한 알림

## 주의사항

1. **환불 처리는 취소 불가**: 환불 처리 후에는 되돌릴 수 없음
2. **금액 자동 계산**: 투어 가격 변경 시 기존 결제는 영향받지 않음
3. **그룹 결제**: 계약금과 잔금은 별도로 처리해야 함

## 문의사항
개발팀에 문의하세요.