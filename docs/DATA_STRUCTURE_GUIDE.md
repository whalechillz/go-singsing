# ì‹±ì‹±ê³¨í”„íˆ¬ì–´ ë°ì´í„° êµ¬ì¡° ì •ì˜ ê°€ì´ë“œ

## ğŸ“‹ Overview
ì‹±ì‹±ê³¨í”„íˆ¬ì–´ ì‹œìŠ¤í…œì˜ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ë° ì‚¬ìš© ê°€ì´ë“œì…ë‹ˆë‹¤.

*ìµœì¢… ì—…ë°ì´íŠ¸: 2025-06-18*

## ğŸ—‚ï¸ ë°ì´í„° ë ˆì´ì–´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ ë§ˆì¼€íŒ…/ê³ ê°ìš© ë°ì´í„° (Marketing Layer)      â”‚
â”‚  - tour_with_auto_badges (VIEW)                 â”‚
â”‚  - ê³ ê° í˜ì´ì§€ í‘œì‹œìš©                           â”‚
â”‚  - ìë™ ê³„ì‚° í•„ë“œ í¬í•¨ (ì°¸ê°€ììˆ˜, ë±ƒì§€ ë“±)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ê¸°ë³¸ íˆ¬ì–´ ë°ì´í„° (Base Layer)               â”‚
â”‚  - singsing_tours (TABLE)                       â”‚
â”‚  - íˆ¬ì–´ ê¸°ë³¸ ì •ë³´ë§Œ ì €ì¥                        â”‚
â”‚  - ë ˆê±°ì‹œ í•„ë“œ í¬í•¨ (ë¯¸ì‚¬ìš© í•„ë“œ ë‹¤ìˆ˜)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       +
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“… ìš´ì˜/ìƒì„¸ ë°ì´í„° (Operational Layer)        â”‚
â”‚  - tour_journey_items (ì¼ì • í•­ëª©)               â”‚
â”‚  - tourist_attractions (ì¥ì†Œ ì •ë³´)              â”‚
â”‚  - tour_boarding_places (íƒ‘ìŠ¹ ì •ë³´)             â”‚
â”‚  - ì‹¤ì œ íˆ¬ì–´ ìš´ì˜ì— í•„ìš”í•œ ìƒì„¸ ì •ë³´           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ì£¼ìš” í…Œì´ë¸” ì„¤ëª…

### 1. **tour_with_auto_badges** (VIEW)
ê³ ê° í˜ì´ì§€ í‘œì‹œìš© í†µí•© ë·°ì…ë‹ˆë‹¤.

**ì£¼ìš” í•„ë“œ:**
- âœ… `current_participants` - ì‹¤ì œ ì°¸ê°€ì ìˆ˜ (ìë™ ê³„ì‚°)
- âœ… `marketing_participant_count` - ë§ˆì¼€íŒ… í‘œì‹œ ì¸ì› (ìˆ˜ë™ ì„¤ì •)
- âœ… `is_closed`, `closed_reason`, `closed_at` - ë§ˆê° ê´€ë ¨
- âœ… `departure_location`, `itinerary`, `included_items`, `notes` - ì¼ì • ì •ë³´
- âœ… `is_special_price`, `special_badge_text`, `badge_priority` - ë±ƒì§€ ê´€ë ¨
- âœ… ëª¨ë“  ë¬¸ì„œ ì„¤ì • í•„ë“œë“¤

### 2. **singsing_tours** (TABLE)
ê¸°ë³¸ íˆ¬ì–´ ì •ë³´ í…Œì´ë¸”ì…ë‹ˆë‹¤.

**í•µì‹¬ í•„ë“œ:**
- `title`, `start_date`, `end_date`
- `price`, `max_participants`
- `tour_product_id` â†’ `tour_products`
- `driver_name`

**âš ï¸ ì£¼ì˜:** ì´ í…Œì´ë¸”ì˜ ë§ì€ í•„ë“œê°€ ë ˆê±°ì‹œë¡œ ì‹¤ì œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### 3. **tour_journey_items** (TABLE)
ì¼ì • ì—¿ë³´ê¸°ì˜ í•µì‹¬ í…Œì´ë¸”ì…ë‹ˆë‹¤.

**êµ¬ì¡°:**
- `tour_id` â†’ íˆ¬ì–´ ì—°ê²°
- `day_number` - ì¼ì°¨
- `order_index` - ìˆœì„œ
- `spot_id` â†’ `tourist_attractions`
- `arrival_time`, `departure_time`
- `meal_type`, `meal_menu`

### 4. **tourist_attractions** (TABLE)
ì¥ì†Œ ì •ë³´ ë§ˆìŠ¤í„° í…Œì´ë¸”ì…ë‹ˆë‹¤.

**ì¹´í…Œê³ ë¦¬:**
- ê³¨í”„ì¥, ì‹ì‚¬(ì¡°ì‹/ì¤‘ì‹/ì„ì‹), ìˆ™ë°•, ê´€ê´‘ì§€
- `main_image_url` - ëŒ€í‘œ ì´ë¯¸ì§€
- `features` - íŠ¹ì§• ë°°ì—´
- `description` - ì„¤ëª…

### 5. **tour_products** (TABLE)
íˆ¬ì–´ ìƒí’ˆ í…œí”Œë¦¿ì…ë‹ˆë‹¤.

**ì£¼ìš” ì •ë³´:**
- `name` - ìƒí’ˆëª…
- `golf_course` - ê³¨í”„ì¥
- `hotel` - ìˆ™ì†Œ
- `included_items`, `excluded_items` - í¬í•¨/ë¶ˆí¬í•¨ ì‚¬í•­

## ğŸ”§ ìš©ì–´ ì •ì˜ ë° ì‚¬ìš© ê·œì¹™

### 1. ìš©ì–´ ì •ì˜

| êµ¬ë¶„ | ìš©ì–´ | ì„¤ëª… | ì‚¬ìš©ì²˜ |
|------|------|------|--------|
| **ë§ˆì¼€íŒ… ë°ì´í„°** | "ë§ˆì¼€íŒ… í‘œì‹œ ì •ë³´" | `tour_with_auto_badges` ë·°ì˜ ë°ì´í„° | ê³ ê° í˜ì´ì§€ |
| **ê¸°ë³¸ ë°ì´í„°** | "íˆ¬ì–´ ê¸°ë³¸ ì •ë³´" | `singsing_tours` í…Œì´ë¸”ì˜ í•µì‹¬ í•„ë“œ | íˆ¬ì–´ ìƒì„±/ìˆ˜ì • |
| **ìš´ì˜ ë°ì´í„°** | "íˆ¬ì–´ ìš´ì˜ ì •ë³´" | journey_items, attractions ë“± | ì¼ì •í‘œ, ë¬¸ì„œ |
| **ì¼ì • ì—¿ë³´ê¸°** | "íˆ¬ì–´ ìƒì„¸ ì¼ì •" | journey_items + attractions ì¡°í•© | ê³ ê° ë¯¸ë¦¬ë³´ê¸° |

### 2. ì‘ì—…ë³„ ì‚¬ìš© ê°€ì´ë“œ

```yaml
ê³ ê° í˜ì´ì§€ í‘œì‹œ:
  - ì‚¬ìš©: tour_with_auto_badges (VIEW)
  - ì´ìœ : ìë™ ê³„ì‚° í•„ë“œ, ë§ˆì¼€íŒ… ì •ë³´ í¬í•¨

íˆ¬ì–´ ìƒì„±/ìˆ˜ì •:
  - ì‚¬ìš©: singsing_tours (TABLE)
  - ì´ìœ : ê¸°ë³¸ ì •ë³´ ì§ì ‘ ìˆ˜ì •

ì¼ì • ìƒì„¸ ê´€ë¦¬:
  - ì‚¬ìš©: tour_journey_items + tourist_attractions
  - ì´ìœ : ì‹¤ì œ ìš´ì˜ ë°ì´í„°

ë¬¸ì„œ ìƒì„±:
  - ê¸°ë³¸ ì •ë³´: tour_with_auto_badges
  - ìƒì„¸ ì¼ì •: tour_journey_items + tourist_attractions
```

### 3. ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ê·œì¹™

```
âŒ "íˆ¬ì–´ ì •ë³´ ìˆ˜ì •í•´ì¤˜"
âœ… "íˆ¬ì–´ ê¸°ë³¸ ì •ë³´ ìˆ˜ì •í•´ì¤˜" (singsing_tours)
âœ… "íˆ¬ì–´ ìš´ì˜ ì¼ì • ìˆ˜ì •í•´ì¤˜" (journey_items)

âŒ "ì¼ì •í‘œ ë³´ì—¬ì¤˜"
âœ… "ë§ˆì¼€íŒ…ìš© ì¼ì •í‘œ ë³´ì—¬ì¤˜" (tour_with_auto_badges)
âœ… "ìš´ì˜ìš© ìƒì„¸ ì¼ì • ë³´ì—¬ì¤˜" (journey_items)

âŒ "ì°¸ê°€ì ìˆ˜ ì—…ë°ì´íŠ¸"
âœ… "ì‹¤ì œ ì°¸ê°€ì ìˆ˜ í™•ì¸" (ìë™ ê³„ì‚°)
âœ… "ë§ˆì¼€íŒ… í‘œì‹œ ì¸ì› ìˆ˜ì •" (marketing_participant_count)
```

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### 1. ë°ì´í„° ë™ê¸°í™”
- `current_participants`ëŠ” íŠ¸ë¦¬ê±°ë¡œ ìë™ ê³„ì‚°ë˜ë¯€ë¡œ ì§ì ‘ ìˆ˜ì • ê¸ˆì§€
- ë§ˆì¼€íŒ… í‘œì‹œ ì¸ì›ì€ ì˜ë„ì ìœ¼ë¡œ ë‹¤ë¥´ê²Œ í‘œì‹œí•  ë•Œë§Œ ì„¤ì •
- ì¼ì • ë°ì´í„°ëŠ” ìš©ë„ë³„ë¡œ ë‹¤ë¥¸ í…Œì´ë¸” ì‚¬ìš©

### 2. ë ˆê±°ì‹œ í•„ë“œ
- `singsing_tours`ì˜ ë§ì€ í•„ë“œê°€ ë¯¸ì‚¬ìš© ìƒíƒœ
- ì‹¤ì œ ì¼ì •ì€ `tour_journey_items` ì‚¬ìš©
- íƒ‘ìŠ¹ ì •ë³´ëŠ” ë³„ë„ í…Œì´ë¸” í™•ì¸ í•„ìš”

### 3. ë·° ì‚¬ìš©ì‹œ ì£¼ì˜
- `tour_with_auto_badges`ëŠ” ë·°ì´ë¯€ë¡œ ì§ì ‘ INSERT/UPDATE ë¶ˆê°€
- ê¸°ë³¸ ë°ì´í„°ëŠ” `singsing_tours`ì—ì„œ ìˆ˜ì •
- ë·°ëŠ” ì¡°íšŒ ì „ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©

## ğŸ“ ì½”ë“œ ì˜ˆì‹œ

### ê³ ê° í˜ì´ì§€ íˆ¬ì–´ ëª©ë¡
```typescript
const { data } = await supabase
  .from("tour_with_auto_badges")
  .select("*")
  .order("start_date", { ascending: true });
```

### íˆ¬ì–´ ê¸°ë³¸ ì •ë³´ ìˆ˜ì •
```typescript
const { error } = await supabase
  .from("singsing_tours")
  .update({ 
    title: "ìƒˆë¡œìš´ íˆ¬ì–´ëª…",
    marketing_participant_count: 20 
  })
  .eq("id", tourId);
```

### ì¼ì • ì—¿ë³´ê¸° ë°ì´í„°
```typescript
const { data } = await supabase
  .from("tour_journey_items")
  .select(`
    *,
    tourist_attraction:tourist_attractions!spot_id(*)
  `)
  .eq("tour_id", tourId)
  .order("day_number", { ascending: true })
  .order("order_index", { ascending: true });
```

## ğŸ”„ í–¥í›„ ê°œì„  ì‚¬í•­

1. **í…Œì´ë¸” ì •ë¦¬**
   - `singsing_tours`ì˜ ë ˆê±°ì‹œ í•„ë“œ ì œê±°
   - ì‹¤ì œ ì‚¬ìš© í•„ë“œë§Œ ë‚¨ê¸°ê³  ì •ë¦¬

2. **í†µí•© ê´€ë¦¬**
   - íˆ¬ì–´ ìš´ì˜ ì •ë³´ ì…ë ¥ UI ê°œì„ 
   - ì¼ì • ì—¿ë³´ê¸° ë°ì´í„° ê´€ë¦¬ ë„êµ¬

3. **ì„±ëŠ¥ ìµœì í™”**
   - ìì£¼ ì‚¬ìš©í•˜ëŠ” ì¡°ì¸ì— ëŒ€í•œ materialized view ê³ ë ¤
   - ì¸ë±ìŠ¤ ìµœì í™”

---

## ğŸ“ ê´€ë ¨ ë¬¸ì„œ
- `/app/page.tsx` - ê³ ê° í˜ì´ì§€
- `/app/admin/tours/page.tsx` - ê´€ë¦¬ì íˆ¬ì–´ ëª©ë¡
- `/components/tour/TourSchedulePreview.tsx` - ì¼ì • ì—¿ë³´ê¸° ì»´í¬ë„ŒíŠ¸